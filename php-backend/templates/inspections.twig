<!DOCTYPE html>
<html>
<head>
    <title>PLE System - Inspections</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Equipment Inspections</h1>
            <nav>
                <a href="index.php" class="button">Equipment List</a>
                <a href="index.php?action=addInspection" class="button-primary">New Inspection</a>
                <div class="user-info">
                    Inspector: {{ user.username }}
                    <a href="index.php?action=logout" class="button">Logout</a>
                </div>
            </nav>
        </header>

        <main>
            <section class="inspections-list">
                <h2>Recent Inspections</h2>
                {% set checklists = R.findAll('checklist', ' ORDER BY date_inspected DESC, time_inspected DESC LIMIT 50') %}
                {% if checklists|length > 0 %}
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Time</th>
                                <th>PLE ID</th>
                                <th>Inspector</th>
                                <th>Status</th>
                                <th>Issues</th>
                                <th>Work Order</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for check in checklists %}
                                <tr>
                                    <td>{{ check.date_inspected|date('Y-m-d') }}</td>
                                    <td>{{ check.time_inspected|date('H:i') }}</td>
                                    <td>{{ check.ple_id }}</td>
                                    <td>{{ check.inspector_initials }}</td>
                                    <td>
                                        {% if check.tagged_out_of_service %}
                                            <span class="status-danger">Out of Service</span>
                                        {% else %}
                                            <span class="status-success">In Service</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% set issues = [] %}
                                        {% if check.damage %}{% set issues = issues|merge(['Damage']) %}{% endif %}
                                        {% if check.leaks %}{% set issues = issues|merge(['Leaks']) %}{% endif %}
                                        {% if check.safety_devices %}{% set issues = issues|merge(['Safety']) %}{% endif %}
                                        {% if check.operation %}{% set issues = issues|merge(['Operation']) %}{% endif %}
                                        {{ issues|join(', ') }}
                                    </td>
                                    <td>{{ check.work_order_number }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No inspections found. Start a new inspection using the button above.</p>
                {% endif %}
            </section>
        </main>
    </div>
</body>
</html>
